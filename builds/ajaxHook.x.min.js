/**
 *	AjaxHook - Global Ajax hooker
 *	--
 *
 *	@package			AjaxHook
 *	@version 			0.1.0.0
 *	@author 			swe <soerenwehmeier@googlemail.com>
 *
 */
define(function(){"use strict";function bindAjaxFN(e,t){Executer.register(e,t)}function unbindAjaxFN(e,t){Executer.removeCallback(e,t)}var AjaxHook={},funcs=["XMLHttpRequest","bindAjaxFN","unbindAjaxFN","author","version"],toBind=["onreadystatechange","success","failure","complete","opened","headers_received","loading","onabort","onerror","onload","onloadend","onloadstart","onprogress","getResponseHeader","getAllResponseHeaders","send","open","setRequestHeader","overrideMimeType"],author="swe",version="0.1.0.0",global=window||this,indexOf=[].indexOf,_r=require,forEach=_r.forEach,extend=_r.extend,unite=_r.unite,Class=_r.Class,capitalizePattern=/(?:^|\s)\S/g,findIndex=indexOf?function(e,t){return indexOf.call(e,t)}:function(e,t){return forEach(e,function(e,n){if(n==t){this.result=e;this.skip=true}},-1)},capitalize=function(e){return e.replace(capitalizePattern,function(e){return e.toUpperCase()})},ArrayList=new Class({create:function(){extend(this,{reference:{},data:[]})},hasReference:function(e){return this.reference[e]!=null&&this.hasIndex(this.reference[e])},hasIndex:function(e){return!!this.data[e]},freeReference:function(e){this.hasReference(e)&&this.data.splice(this.reference[e],1)},addByReference:function(e,t){this.freeReference(e);this.reference[e]=this.data.length;this.data.push({content:t,reference:e})},mergeWith:function(e){var t=this;forEach(e,function(e,n){t.add(e,n)})},getByReference:function(e){return this.hasReference(e)&&this.data[this.reference[e]].content},getIndexByReference:function(e){return this.hasReference(e)&&this.reference[e]},removeByReference:function(e){if(this.hasReference(e)){this.data.splice(this.reference[e],1);this.reference[e]=null;delete this.reference[e]}},getByIndex:function(e){return this.hasIndex(e)&&this.data[e].content},getReferenceByIndex:function(e){return this.hasIndex(e)&&this.data[e].reference},removeByIndex:function(){if(this.hasIndex(index)){this.reference[this.data[index].reference]=null;delete this.reference[this.data[index].reference];this.data.splice(index,1)}},size:function(){return this.data.length}}),Executer=new Class({"static":{callbacks:new ArrayList,register:function(e,t){Executer.callbacks.hasReference(e)?Executer.callbacks.getByReference(e).push(t):Executer.callbacks.addByReference(e,[t])},unregister:function(e){Executer.callbacks.removeByReference(e)},execCallbacks:function(e,t,n){Executer.callbacks.hasReference(e)&&forEach(Executer.callbacks.getByReference(e),function(e,r){r.apply(t,n)})},removeCallback:function(e,t){if(Executer.callbacks.hasReference(e)){var n=findIndex(Executer.callbacks.getByReference(e));if(n>-1){Executer.callbacks.getByReference(e).splice(n,1)}}}}}),NativeFNWrapper=new Class({"static":{xmlhttp:global.XMLHttpRequest,allocate:!!global.XMLHttpRequest?function(){return new NativeFNWrapper.xmlhttp}:function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}return!!e?e:false},exec:function(object,prop,args){var result;try{result=object[prop].apply(object,args)}catch(e){eval("result = object."+prop+"("+forEach(args,function(e,t){this.result.push(typeof t=="string"?'"'+t+'"':t)},[]).join(",")+");")}Executer.execCallbacks(prop,object,args);return result}}}),XMLHttpWrapper=new Class({create:function(){var e=this,t=function(t,n){Executer.execCallbacks(t,e._nat,n);!!e[t]&&e[t].apply(e._nat,n)};extend(e,{_nat:extend(NativeFNWrapper.allocate(),{onreadystatechange:function(){if((e.readyState=e._nat.readyState)==e.DONE){forEach(["responseText","responseXml","status","statusText"],function(t,n){e[n]=e._nat[n]});Executer.execCallbacks("complete",e._nat,arguments);e.status==200?Executer.execCallbacks("success",e._nat,arguments):Executer.execCallbacks("failure",e._nat,arguments)}e.readyState==e.OPENED&&Executer.execCallbacks("opened",e._nat,arguments);e.readyState==e.HEADERS_RECEIVED&&Executer.execCallbacks("headers_received",e._nat,arguments);e.readyState==e.LOADING&&Executer.execCallbacks("loading",e._nat,arguments);t("onreadystatechange",arguments)},onabort:function(){t("onabort",arguments)},onerror:function(){t("onerror",arguments)},onload:function(){t("onload",arguments)},onloadend:function(){t("onloadend",arguments)},onloadstart:function(){t("onloadstart",arguments)},onprogress:function(){t("onprogress",arguments)}}),responseText:"",responseXml:null,readyState:0,status:0,statusText:0,withCredentials:false,upload:null,responseType:null})},UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4,abort:function(){return NativeFNWrapper.exec(this._nat,"abort",arguments)},getResponseHeader:function(){return NativeFNWrapper.exec(this._nat,"getResponseHeader",arguments)},getAllResponseHeaders:function(){return NativeFNWrapper.exec(this._nat,"getAllResponseHeaders",arguments)},send:function(){return NativeFNWrapper.exec(this._nat,"send",arguments)},open:function(e,t){var n=this;forEach(["withCredentials","upload","responseType"],function(e,t){!!n[t]&&(n._nat[t]=n[t])});n.url=n._nat.url=t;return NativeFNWrapper.exec(n._nat,"open",arguments)},setRequestHeader:function(){return NativeFNWrapper.exec(this._nat,"setRequestHeader",arguments)},overrideMimeType:function(){return NativeFNWrapper.exec(this._nat,"overrideMimeType",arguments)}});extend(AjaxHook,unite(funcs,[XMLHttpWrapper,bindAjaxFN,unbindAjaxFN,author,version]));forEach(toBind,function(e,t){var n="bindAjax"+capitalize(t);AjaxHook[n]=function(e){bindAjaxFN(t,e)};AjaxHook["un"+n]=function(e){unbindAjaxFN(t,e)}});extend(global,AjaxHook);extend(global.AjaxHook={},AjaxHook);return AjaxHook})